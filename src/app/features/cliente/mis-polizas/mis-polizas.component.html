<div class="polizas-container">
  <div class="header-section">
    <div class="header-content">
      <div>
        <h1>Mis Pólizas</h1>
        <p>Consulta y gestiona tus pólizas de seguros</p>
      </div>
    </div>
  </div>

  <!-- Error message -->
  <div class="error-message" *ngIf="errorMessage">
    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
      <circle cx="12" cy="12" r="10"></circle>
      <line x1="12" y1="8" x2="12" y2="12"></line>
      <line x1="12" y1="16" x2="12.01" y2="16"></line>
    </svg>
    {{ errorMessage }}
  </div>

  <!-- Loading state -->
  <div class="loading-container" *ngIf="isLoading">
    <div class="loading-spinner">
      <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <path d="M21 12a9 9 0 1 1-6.219-8.56"/>
      </svg>
    </div>
    <p>Cargando pólizas...</p>
  </div>

  <!-- Empty state -->
  <div class="empty-state" *ngIf="!isLoading && polizas.length === 0 && !errorMessage">
    <svg width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
      <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
      <polyline points="14 2 14 8 20 8"></polyline>
      <line x1="16" y1="13" x2="8" y2="13"></line>
      <line x1="16" y1="17" x2="8" y2="17"></line>
    </svg>
    <h3>No tienes pólizas registradas</h3>
    <p>Contacta con tu asesor para obtener más información sobre nuestros productos</p>
  </div>

  <!-- Table -->
  <div class="table-container" *ngIf="!isLoading && polizas.length > 0">
    <table class="polizas-table">
      <thead>
        <tr>
          <th>ID</th>
          <th>Tipo</th>
          <th>Fecha Inicio</th>
          <th>Fecha Expiración</th>
          <th>Monto</th>
          <th>Estado</th>
          <th>Acciones</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let poliza of polizas">
          <td class="id-cell">#{{ poliza.id }}</td>
          <td>
            <span class="tipo-badge tipo-{{ poliza.tipoPoliza }}">
              {{ getTipoPolizaLabel(poliza.tipoPoliza) }}
            </span>
          </td>
          <td>{{ formatDate(poliza.fechaInicio) }}</td>
          <td>{{ formatDate(poliza.fechaFin) }}</td>
          <td class="monto-cell">{{ formatCurrency(poliza.monto) }}</td>
          <td>
            <span class="status-badge" [ngClass]="getEstatusClass(poliza.estatus)">
              {{ getEstatusLabel(poliza.estatus) }}
            </span>
          </td>
          <td class="actions-cell">
            <button
              *ngIf="poliza.estatus === EstatusPoliza.Vigente"
              class="action-btn cancel-btn" 
              (click)="confirmCancel(poliza, $event)"
              title="Cancelar póliza"
            >
              <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <circle cx="12" cy="12" r="10"></circle>
                <line x1="15" y1="9" x2="9" y2="15"></line>
                <line x1="9" y1="9" x2="15" y2="15"></line>
              </svg>
              <span>Cancelar</span>
            </button>
            <span *ngIf="poliza.estatus === EstatusPoliza.Cancelada" class="no-action">Cancelada</span>
          </td>
        </tr>
      </tbody>
    </table>
  </div>
</div>

<!-- Modal de Confirmación de Cancelación -->
<div class="modal-overlay" *ngIf="showCancelConfirm" (click)="cancelCancel()">
  <div class="confirm-modal" (click)="$event.stopPropagation()">
    <div class="confirm-header">
      <div class="confirm-icon warning">
        <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"></path>
          <line x1="12" y1="9" x2="12" y2="13"></line>
          <line x1="12" y1="17" x2="12.01" y2="17"></line>
        </svg>
      </div>
      <h2>¿Cancelar Póliza?</h2>
    </div>
    <div class="confirm-body" *ngIf="polizaToCancel">
      <p>¿Estás seguro de que deseas cancelar la póliza <strong>#{{ polizaToCancel.id }}</strong> de tipo <strong>{{ getTipoPolizaLabel(polizaToCancel.tipoPoliza) }}</strong>?</p>
      <p class="warning-text">Esta acción no se puede deshacer.</p>
    </div>
    <div class="confirm-actions">
      <button class="btn btn-secondary" (click)="cancelCancel()" [disabled]="isLoading">
        No, mantener activa
      </button>
      <button class="btn btn-danger" (click)="cancelarPoliza()" [disabled]="isLoading" [class.loading]="isLoading">
        <span *ngIf="!isLoading">Sí, cancelar</span>
        <span *ngIf="isLoading" class="loading-spinner">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M21 12a9 9 0 1 1-6.219-8.56"/>
          </svg>
          Cancelando...
        </span>
      </button>
    </div>
  </div>
</div>
