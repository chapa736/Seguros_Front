<div class="clientes-container">
  <div class="header-section">
    <div class="header-content">
      <div>
        <h1>Gestión de Clientes</h1>
        <p>Administra y modifica la información de los clientes</p>
      </div>
      <div class="header-actions">
        <button class="btn btn-secondary btn-filters" (click)="toggleFiltros()">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <polygon points="22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3"></polygon>
          </svg>
          <span>Filtros</span>
        </button>
      </div>
    </div>
  </div>

  <!-- Panel de Filtros -->
  <div class="filters-panel" *ngIf="mostrarFiltros">
    <div class="filters-content">
      <h3>Filtrar Clientes</h3>
      
      <div class="filters-grid">
        <div class="filter-group">
          <label for="filtroTexto">Buscar por nombre, correo o número de identificación</label>
          <input
            type="text"
            id="filtroTexto"
            [(ngModel)]="filtroTexto"
            class="filter-input"
            placeholder="Ej: Juan Pérez, juan@email.com, 1234567890"
            (keyup.enter)="aplicarFiltros()"
          />
        </div>
      </div>

      <div class="filters-actions">
        <button class="btn btn-primary" (click)="aplicarFiltros()">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <circle cx="11" cy="11" r="8"></circle>
            <path d="M21 21l-4.35-4.35"></path>
          </svg>
          <span>Buscar</span>
        </button>
        <button class="btn btn-secondary" (click)="limpiarFiltros()">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <line x1="18" y1="6" x2="6" y2="18"></line>
            <line x1="6" y1="6" x2="18" y2="18"></line>
          </svg>
          <span>Limpiar</span>
        </button>
      </div>
    </div>
  </div>

  <!-- Error message -->
  <div class="error-message" *ngIf="errorMessage">
    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
      <circle cx="12" cy="12" r="10"></circle>
      <line x1="12" y1="8" x2="12" y2="12"></line>
      <line x1="12" y1="16" x2="12.01" y2="16"></line>
    </svg>
    {{ errorMessage }}
  </div>

  <!-- Loading state -->
  <div class="loading-container" *ngIf="isLoading">
    <div class="loading-spinner">
      <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <path d="M21 12a9 9 0 1 1-6.219-8.56"/>
      </svg>
    </div>
    <p>Cargando clientes...</p>
  </div>

  <!-- Empty state -->
  <div class="empty-state" *ngIf="!isLoading && clientes.length === 0 && !errorMessage">
    <svg width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
      <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path>
      <circle cx="9" cy="7" r="4"></circle>
      <path d="M23 21v-2a4 4 0 0 0-3-3.87"></path>
      <path d="M16 3.13a4 4 0 0 1 0 7.75"></path>
    </svg>
    <h3>No hay clientes registrados</h3>
    <p>Registra tu primer cliente para comenzar</p>
  </div>

  <!-- Table -->
  <div class="table-container" *ngIf="!isLoading && clientes.length > 0">
    <table class="clientes-table">
      <thead>
        <tr>
          <th>ID</th>
          <th>Nombre Completo</th>
          <th>Número de Identificación</th>
          <th>Email</th>
          <th>Teléfono</th>
          <th>Dirección</th>
          <th>Acciones</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let cliente of clientes" (click)="selectCliente(cliente)" class="table-row">
          <td class="id-cell">#{{ cliente.id }}</td>
          <td class="name-cell">
            <div class="name-content">
              <div class="name-avatar">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
                  <circle cx="12" cy="7" r="4"></circle>
                </svg>
              </div>
              <strong>{{ cliente.nombreCompleto }}</strong>
            </div>
          </td>
          <td>{{ cliente.numeroIdentificacion }}</td>
          <td>{{ cliente.email }}</td>
          <td>{{ cliente.telefono }}</td>
          <td class="address-cell">{{ cliente.direccion }}</td>
          <td class="actions-cell">
            <button 
              class="action-btn edit-btn" 
              (click)="selectCliente(cliente); $event.stopPropagation()"
              title="Editar cliente"
            >
              <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path>
                <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path>
              </svg>
            </button>
            <button 
              class="action-btn delete-btn" 
              (click)="confirmDelete(cliente, $event)"
              title="Eliminar cliente"
            >
              <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <polyline points="3 6 5 6 21 6"></polyline>
                <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
              </svg>
            </button>
          </td>
        </tr>
      </tbody>
    </table>
  </div>
</div>

<!-- Modal de Edición -->
<div class="modal-overlay" *ngIf="showEditModal" (click)="closeEditModal()">
  <div class="modal-content" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h2>Editar Cliente</h2>
      <button class="close-btn" (click)="closeEditModal()">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <line x1="18" y1="6" x2="6" y2="18"></line>
          <line x1="6" y1="6" x2="18" y2="18"></line>
        </svg>
      </button>
    </div>

    <form [formGroup]="clienteForm" (ngSubmit)="onSubmit()" class="edit-form">
      <div class="form-group">
        <label for="numeroIdentificacion" class="form-label">
          <svg class="input-icon" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
            <polyline points="14 2 14 8 20 8"></polyline>
          </svg>
          Número de Identificación
        </label>
        <input
          type="text"
          id="numeroIdentificacion"
          formControlName="numeroIdentificacion"
          class="form-input"
          readonly
        />
        <span class="readonly-hint">Este campo no se puede modificar</span>
      </div>

      <div class="form-row">
        <div class="form-group">
          <label for="nombre" class="form-label">
            <svg class="input-icon" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
              <circle cx="12" cy="7" r="4"></circle>
            </svg>
            Nombre(s)
            <span class="required">*</span>
          </label>
          <input
            type="text"
            id="nombre"
            formControlName="nombre"
            class="form-input"
            [class.error]="nombre?.invalid && nombre?.touched"
            placeholder="Ej: Juan"
          />
          <span class="error-message" *ngIf="nombre?.hasError('required') && nombre?.touched">
            El nombre es requerido
          </span>
          <span class="error-message" *ngIf="nombre?.hasError('invalidName') && nombre?.touched">
            El nombre no debe contener números ni caracteres especiales
          </span>
        </div>

        <div class="form-group">
          <label for="apPaterno" class="form-label">
            <svg class="input-icon" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
              <circle cx="12" cy="7" r="4"></circle>
            </svg>
            Apellido Paterno
            <span class="required">*</span>
          </label>
          <input
            type="text"
            id="apPaterno"
            formControlName="apPaterno"
            class="form-input"
            [class.error]="apPaterno?.invalid && apPaterno?.touched"
            placeholder="Ej: Pérez"
          />
          <span class="error-message" *ngIf="apPaterno?.hasError('required') && apPaterno?.touched">
            El apellido paterno es requerido
          </span>
          <span class="error-message" *ngIf="apPaterno?.hasError('invalidName') && apPaterno?.touched">
            El apellido paterno no debe contener números ni caracteres especiales
          </span>
        </div>
      </div>

      <div class="form-group">
        <label for="apMaterno" class="form-label">
          <svg class="input-icon" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
            <circle cx="12" cy="7" r="4"></circle>
          </svg>
          Apellido Materno
          <span class="required">*</span>
        </label>
        <input
          type="text"
          id="apMaterno"
          formControlName="apMaterno"
          class="form-input"
          [class.error]="apMaterno?.invalid && apMaterno?.touched"
          placeholder="Ej: García"
        />
        <span class="error-message" *ngIf="apMaterno?.hasError('required') && apMaterno?.touched">
          El apellido materno es requerido
        </span>
        <span class="error-message" *ngIf="apMaterno?.hasError('invalidName') && apMaterno?.touched">
          El apellido materno no debe contener números ni caracteres especiales
        </span>
      </div>

      <div class="form-row">
        <div class="form-group">
          <label for="email" class="form-label">
            <svg class="input-icon" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"></path>
              <polyline points="22,6 12,13 2,6"></polyline>
            </svg>
            Correo Electrónico
            <span class="required">*</span>
          </label>
          <input
            type="email"
            id="email"
            formControlName="email"
            class="form-input"
            [class.error]="email?.invalid && email?.touched"
            placeholder="Ej: juan.perez@example.com"
          />
          <span class="error-message" *ngIf="email?.hasError('required') && email?.touched">
            El correo electrónico es requerido
          </span>
          <span class="error-message" *ngIf="email?.hasError('email') && email?.touched">
            El correo electrónico no es válido
          </span>
        </div>

        <div class="form-group">
          <label for="telefono" class="form-label">
            <svg class="input-icon" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-3.95-3.95A19.79 19.79 0 0 1 2 4.18 2 2 0 0 1 4.18 2h3a2 2 0 0 1 2 1.72c.1.95.43 1.9.99 2.82A8.7 8.7 0 0 1 12 9c.85 0 1.7-.11 2.5-.34a4.9 4.9 0 0 1 2.82.99 2 2 0 0 1 1.72 2z"></path>
            </svg>
            Teléfono
            <span class="required">*</span>
          </label>
          <input
            type="tel"
            id="telefono"
            formControlName="telefono"
            class="form-input"
            [class.error]="telefono?.invalid && telefono?.touched"
            placeholder="Ej: 5512345678"
          />
          <span class="error-message" *ngIf="telefono?.hasError('required') && telefono?.touched">
            El teléfono es requerido
          </span>
          <span class="error-message" *ngIf="telefono?.hasError('pattern') && telefono?.touched">
            El teléfono debe ser de 10 dígitos numéricos
          </span>
        </div>
      </div>

      <div class="form-group">
        <label for="direccion" class="form-label">
          <svg class="input-icon" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"></path>
          </svg>
          Dirección
          <span class="required">*</span>
        </label>
        <input
          type="text"
          id="direccion"
          formControlName="direccion"
          class="form-input"
          [class.error]="direccion?.invalid && direccion?.touched"
          placeholder="Ej: Calle Falsa 123, Ciudad"
        />
        <span class="error-message" *ngIf="direccion?.hasError('required') && direccion?.touched">
          La dirección es requerida
        </span>
      </div>

      <div class="error-message-server" *ngIf="errorMessage">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <circle cx="12" cy="12" r="10"></circle>
          <line x1="12" y1="8" x2="12" y2="12"></line>
          <line x1="12" y1="16" x2="12.01" y2="16"></line>
        </svg>
        {{ errorMessage }}
      </div>

      <div class="form-actions">
        <button type="button" class="btn btn-secondary" (click)="closeEditModal()" [disabled]="isSubmitting">
          Cancelar
        </button>
        <button type="submit" class="btn btn-primary" [disabled]="isSubmitting || clienteForm.invalid" [class.loading]="isSubmitting">
          <span *ngIf="!isSubmitting">Guardar Cambios</span>
          <span *ngIf="isSubmitting" class="loading-spinner">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M21 12a9 9 0 1 1-6.219-8.56"/>
            </svg>
            Guardando...
          </span>
        </button>
      </div>
    </form>
  </div>
</div>

<!-- Modal de Confirmación de Eliminación -->
<div class="modal-overlay" *ngIf="showDeleteConfirm" (click)="cancelDelete()">
  <div class="confirm-modal" (click)="$event.stopPropagation()">
    <div class="confirm-header">
      <div class="confirm-icon error">
        <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <circle cx="12" cy="12" r="10"></circle>
          <line x1="15" y1="9" x2="9" y2="15"></line>
          <line x1="9" y1="9" x2="15" y2="15"></line>
        </svg>
      </div>
      <h2>¿Eliminar Cliente?</h2>
    </div>
    <div class="confirm-body">
      <p>¿Estás seguro de que deseas eliminar al cliente <strong>{{ clienteToDelete?.nombreCompleto }}</strong>?</p>
      <p class="warning-text">Esta acción no se puede deshacer.</p>
    </div>
    <div class="confirm-actions">
      <button class="btn btn-secondary" (click)="cancelDelete()" [disabled]="isLoading">
        Cancelar
      </button>
      <button class="btn btn-danger" (click)="deleteCliente()" [disabled]="isLoading" [class.loading]="isLoading">
        <span *ngIf="!isLoading">Eliminar</span>
        <span *ngIf="isLoading" class="loading-spinner">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M21 12a9 9 0 1 1-6.219-8.56"/>
          </svg>
          Eliminando...
        </span>
      </button>
    </div>
  </div>
</div>
